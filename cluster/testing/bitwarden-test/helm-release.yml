---
apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
  name: bitwarden
  namespace: testing
spec:
  interval: 5m
  chart:
    spec:
      # renovate: registryUrl=https://k8s-at-home.com/charts/
      chart: bitwardenrs
      version: 2.0.2
      sourceRef:
        kind: HelmRepository
        name: k8s-at-home-charts
        namespace: flux-system
      interval: 5m
  values:
    replicaCount: 1

    bitwardenrs:
      domain: "https://bitwarden.kube.luander.net"
      signupsAllowed: false
      websockets:
        enabled: true
        port: 3012
      admin:
        enabled: true
        disableAdminToken: false
        existingSecret:
          enabled: false
          name: ""
          tokenKey: ""
      # Enable SMTP. https://github.com/dani-garcia/bitwarden_rs/wiki/SMTP-configuration
      smtp:
        enabled: true
        # SMTP hostname, required if SMTP is enabled
        host: "mail.gandi.net"
        # SMTP sender e-mail address, required if SMTP is enabled
        from: "noreply@luander.net"
        # SMTP sender name, defaults to 'Bitwarden_RS'
        fromName: "Bitwarden"
        # Enable SSL connection
        ssl: true
        # SMTP port
        port: 587
        # Use existing secret for SMTP authentication
        existingSecret:
          enabled: true
          name: "bitwardensmtp"
          userKey: "username"
          passwordKey: "password"

    env: {}

    persistence:
      type: statefulset
      enabled: true
      size: 1Gi
      accessMode: ReadWriteOnce
      storageClass: longhorn
      ## Use existing Persistent Volume Claim
      # existingClaim:

    ingress:
      enabled: true
      annotations:
        kubernetes.io/ingress.class: nginx
        # kubernetes.io/tls-acme: "true"
      hosts:
      - host: "bitwarden.kube.luander.net"
        paths:
        - "/"
      tls: []
      #  - secretName: chart-example-tls
      #    hosts:
      #      - chart-example.local

    resources:
      limits:
        cpu: 500m
        memory: 512Mi
      requests:
        cpu: 100m
        memory: 128Mi
